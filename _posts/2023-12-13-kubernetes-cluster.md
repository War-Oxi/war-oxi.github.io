---
title: Kubernetes Cluster êµ¬ì„± ë° ê°œë…
date: 2023-12-13 22:54:32 +0900
author: kkamji
categories: [Kubernetes]
tags: [kubernetes, k8s, k8s-cluster, cluster, api-server, etcd, controller-management, scheduler, kubelet, kube-proxy, containerd, container]     # TAG names should always be lowercase
comments: true
image:
  path: https://github.com/kkamji98/kkamji98.github.io/assets/72260110/c39504c6-3de4-4b41-919b-5ef1b132106c
---
## Concept

> ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜  ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì¼ë ¨ì˜ ë…¸ë“œ ë¨¸ì‹ ë“¤ì˜ ì§‘í•©ìž…ë‹ˆë‹¤.

- í´ëŸ¬ìŠ¤í„°ëŠ” **Control-Plane** ë° í•˜ë‚˜ ì´ìƒì˜ ì»´í“¨íŒ… ë¨¸ì‹  ë˜ëŠ” ë…¸ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
- ì»¨íŠ¸ë¡¤í”Œë ˆì¸ì´ ì–´ëŠ Applicationì„ ì‹¤í–‰í•˜ê³  Applicationì´ ì–´ëŠ Conatiner Imageë¥¼ ì‚¬ìš©í• ì§€ì™€ ê°™ì´ í´ëŸ¬ìŠ¤í„°ë¥¼ ì›í•˜ëŠ” ìƒíƒœë¡œ ìœ ì§€ ê´€ë¦¬í•©ë‹ˆë‹¤. NodeëŠ” Control Planeì—ì„œ ìš”ì²­ì„ ë°›ì•„ Appliationê³¼ Workloadë¥¼ ì‹¤ì œë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤
- ë”°ë¼ì„œ ë¬¼ë¦¬ ë¨¸ì‹ , ê°€ìƒ ë¨¸ì‹ , ì˜¨í”„ë ˆë¯¸ìŠ¤, í´ë¼ìš°ë“œì— êµ¬ì• ë°›ì§€ ì•Šê³  ë¨¸ì‹  ê·¸ë£¹ ì „ì²´ì—ì„œ ì»¨í…Œì´ë„ˆë¥¼ ì˜ˆì•½í•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

## Master Node

> í´ëŸ¬ìŠ¤í„°ì˜ ì „ë°˜ì ì¸ ê´€ë¦¬ì™€ ì¡°ì •ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤. ì—¬ëŸ¬ ê°œì˜ ë§ˆìŠ¤í„° ë…¸ë“œë¡œ êµ¬ì„±ë  ìˆ˜ ìžˆì–´ ê³ ê°€ìš©ì„±(HA)ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

### etcd

> ðŸ”¥ í‚¤ ê°’ í˜•ì‹ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  ìƒíƒœì™€ ì •ë³´ë¥¼ ì €ìž¥í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ìž…ë‹ˆë‹¤.
> ë°ì´í„°ë² ì´ìŠ¤, ë¶„ì‚° ì‹œìŠ¤í…œì„ ìœ„í•œ ì‹ ë¢°í•  ìˆ˜ ìžˆëŠ” í‚¤-ê°’ ìŠ¤í† ì–´. ë‹¨ìˆœí•˜ê³  ì•ˆì „í•˜ë©° ì‹ ì†í•©ë‹ˆë‹¤
> â‡’ k8sí´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  ìƒíƒœ ì •ë³´ì™€ ë©”íƒ€ë°ì´í„°ê°€ ì €ìž¥ë©ë‹ˆë‹¤.
{: .prompt-tip}

- etcd ë°ì´í„° ì €ìž¥ì†Œì— ì €ìž¥ë˜ëŠ” Clusterì— ê´€í•œ ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
  - Nodes
  - Pods
  - Configs
  - Secrets
  - Accounts
  - Roles
  - Bindings
  - Others

#### etcdì˜ ì—­í• ê³¼ ì¤‘ìš”ì„±

1. í´ëŸ¬ìŠ¤í„° ìƒíƒœ ì €ìž¥
2. ë°ì´í„°ì˜ ì¼ê´€ì„± ìœ ì§€
    - Raft í•©ì˜ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•´ í´ëŸ¬ìŠ¤í„° ì „ë°˜ì— ê±¸ì³ ë°ì´í„°ì˜ ê°•ë ¥í•œ ì¼ê´€ì„±ì„ ë³´ìž¥
3. ê³ ê°€ìš©ì„±
4. ë³€ê²½ ê°ì§€ ë° ê°ì‹œ ê¸°ëŠ¥
    - key-value ë°ì´í„°ì— ëŒ€í•œ ë³‘ê²½ ì‚¬í•­ì„ ê°ì‹œí•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•¨.
    - etcdë¥¼ í†µí•´ k8sëŠ” í´ëŸ¬ìŠ¤í„°ì˜ ìƒíƒœ ë³€í™”ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•˜ê³ , í•„ìš”í•œ ì¡°ì¹˜ë¥¼ ì·¨í•  ìˆ˜ ìžˆìŒ

#### k8sì™€ etcdì˜ ìƒí˜¸ ìž‘ìš©

- **API ì„œë²„ì™€ì˜ í†µì‹ :** Kubernetesì˜ API ì„œë²„ëŠ” í´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  ì •ë³´ë¥¼ etcdì— ì½ê³  ì“°ëŠ” ì£¼ëœ ë°©ë²•ìž…ë‹ˆë‹¤. API ì„œë²„ëŠ” etcdì™€ì˜ ìƒí˜¸ìž‘ìš©ì„ í†µí•´ í´ëŸ¬ìŠ¤í„° ìƒíƒœì˜ ë³€ê²½ ì‚¬í•­ì„ ë°˜ì˜í•˜ê³  ì¡°íšŒí•©ë‹ˆë‹¤.
- **í´ëŸ¬ìŠ¤í„° ë³µì›ë ¥:** etcdì˜ ë†’ì€ ê°€ìš©ì„±ê³¼ ì¼ê´€ì„±ì€ Kubernetes í´ëŸ¬ìŠ¤í„°ì˜ ì „ë°˜ì ì¸ ë³µì›ë ¥ê³¼ ì•ˆì •ì„±ì„ ê°•í™”í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë§ˆìŠ¤í„° ë…¸ë“œê°€ ì‹¤íŒ¨í•  ê²½ìš°, etcd ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ í´ëŸ¬ìŠ¤í„° ìƒíƒœë¥¼ ë³µì›í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
- **ìŠ¤ì¼€ì¼ë§ê³¼ ì—…ë°ì´íŠ¸:** í´ëŸ¬ìŠ¤í„°ì˜ ìŠ¤ì¼€ì¼ë§ì´ë‚˜ ì—…ë°ì´íŠ¸ ì‹œ, etcdëŠ” ìƒˆë¡œìš´ ë…¸ë“œë‚˜ ì„œë¹„ìŠ¤ì˜ ì •ë³´ë¥¼ ì €ìž¥í•˜ê³ , ì´ë¥¼ í´ëŸ¬ìŠ¤í„° ì „ì²´ì™€ ë™ê¸°í™”í•©ë‹ˆë‹¤.

### api-server

> ðŸ”¥ ì¿ ë²„ë„¤í‹°ìŠ¤ APIë¥¼ ì œê³µí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¡œ, ì‚¬ìš©ìž í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ë‹¤ì–‘í•œ ì»´í¬ë„ŒíŠ¸ì™€ í†µì‹ ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤
{: .prompt-tip}

- api-serverë¥¼ í†µí•´ ì‚¬ìš©ìž, í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì˜ ë‹¤ì–‘í•œ ì»´í¬ë„ŒíŠ¸, ê·¸ë¦¬ê³  ì™¸ë¶€ ì‹œìŠ¤í…œë“¤ì´ í´ëŸ¬ìŠ¤í„°ì™€ ìƒí˜¸ ìž‘ìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
- **RESTful Interface**
  - í´ë¼ì´ì–¸íŠ¸ê°€ HTTP ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ë¦¬ì†ŒìŠ¤(Pod, Service ë“±)ë¥¼ ìƒì„±, ìˆ˜ì •, ì‚­ì œí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
- **ì¸ì¦ ë° ê¶Œí•œ ë¶€ì—¬**
  - í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì— ëŒ€í•œ ì¸ì¦ê³¼ ê¶Œí•œ ë¶€ì—¬ ì ˆì°¨ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
- **í´ëŸ¬ìŠ¤í„° ìƒíƒœ ê´€ë¦¬**
  - api-serverëŠ” í´ëŸ¬ìŠ¤í„°ì˜ ìƒíƒœë¥¼ etcdì™€ ê°™ì€ ë¶„ì‚° í‚¤-ê°’ ì €ìž¥ì†Œì— ì €ìž¥í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.
- ë¦¬ì†ŒìŠ¤ ìœ íš¨ì„± ê²€ì‚¬ ë° ì ìš©
  - í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ìš”ì²­ì„ ë°›ìœ¼ë©´, í•´ë‹¹ ìš”ì²­ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê³ , ê·œì¹™ì— ë§žëŠ” ê²½ìš°ì—ë§Œ ì‹œìŠ¤í…œì— ì ìš©í•©ë‹ˆë‹¤

### controller-manager

> ì¿ ë²„ë„¤í‹°ìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì¢…ë¥˜ê°€ ë§¤ìš° ë‹¤ì–‘í•©ë‹ˆë‹¤. ì˜ˆì‹œë¡œ ì•„ëž˜ ë‘ ê°œì˜ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ìžˆìŠµë‹ˆë‹¤. ì´ ì»¨íŠ¸ë¡¤ëŸ¬ ë“¤ì€ Kube Controller Managerë¼ëŠ” í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ë¡œ íŒ¨í‚¤ì§€í™”ë˜ì–´ ê´€ë¦¬ë©ë‹ˆë‹¤

- Kube Controller Managerë¥¼ ì„¤ì¹˜í•˜ë©´ ë‚˜ë¨¸ì§€ ë‹¤ë¥¸ ì»¨íŠ¸ë¡¤ëŸ¬ë„ ê°™ì´ ì„¤ì¹˜ë¨

### scheduler

> Node Podë¥¼ Scheduling

- Podë¥¼ ì–´ë””ì— ë°°ì¹˜ì‹œí‚¬ì§€ ê²°ì •

## Worker Node

### kubelet

> í´ëŸ¬ìŠ¤í„°ì˜ ê° ë…¸ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” Agent  
> ðŸ”¥ API ì„œë²„ë¡œë¶€í„° Pod ëª…ì„¸ë¥¼ ë°›ì•„, ì´ë¥¼ í•´ì„ í›„ ì»¨í…Œì´ë„ˆ ì‹¤í–‰í•©ë‹ˆë‹¤.
{: .prompt-tip}

- Kube API ì„œë²„ì˜ ì§€ì‹œë¥¼ ë“£ê³  í•„ìš”í•œëŒ€ë¡œ ë…¸ë“œì—ì„œ ì»¨í…Œì´ë„ˆë¥¼ ë°°í¬í•˜ê±°ë‚˜ íŒŒê´´í•©ë‹ˆë‹¤
- Kube API ì„œë²„ëŠ” ì£¼ê¸°ì ìœ¼ë¡œ Kubeletìœ¼ë¡œë¶€í„° ìƒíƒœ ë³´ê³ ì„œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤
- í´ëŸ¬ìŠ¤í„°ì˜ ê° ë…¸ë“œì˜ kubeletì€ podì˜ ìƒíƒœë¥¼ í™•ì¸ í›„ k8s api ì„œë²„ì— ë³´ê³ í•©ë‹ˆë‹¤.
  - â‡’ ë…¸ë“œì™€ ì»¨í…Œì´ë„ˆì˜ ìƒíƒœë¥¼ ëª¨ë‹ˆí„°ë§

### Worker Nodeê°€ Master Nodeì™€ ì—°ê²°ì´ ëŠê²¼ì„ ê²½ìš°

- kube-apiserverì™€ kube-schedulerê°€ ì—†ê¸° ë•Œë¬¸ì— kubeletì€ ì™¸ë¶€ì—ì„œ ëª…ë ¹ì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
- í•´ë‹¹ Worker NodeëŠ” ë…ë¦½ì ìœ¼ë¡œ ì¡´ìž¬í•˜ë©° í•´ë‹¹ Worker Nodeì˜ kubeletì€ ë…ë¦½ì ìœ¼ë¡œ Podsë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤
- ì´ ê²½ìš° kubeletì€ Podsë¥¼ ì–´ë–»ê²Œ ê´€ë¦¬í• ê¹Œ?
  - Podì— ê´€í•œ ì •ë³´ë¥¼ ì €ìž¥í•˜ëŠ” ì„œë²„ ë””ë ‰í† ë¦¬ë¥¼ í†µí•´ Pod ì •ì˜ íŒŒì¼ì„ ì½ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
    - `/etc/kubernetes/menifests` - ì„œë²„ ë””ë ‰í† ë¦¬
    - ì„œë²„ë””ë ‰í† ë¦¬ì— Pod ì •ì˜ íŒŒì¼ì„ ë„£ì–´ë‘ë©´ kubeletì€ ì£¼ê¸°ì ìœ¼ë¡œ ì„œë²„ ë””ë ‰í† ë¦¬ë¥¼ í™•ì¸í•œ í›„ Hostì— Podë¥¼ ìƒì„±í•©ë‹ˆë‹¤

### kube-proxy

> K8s í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ë„¤íŠ¸ì›Œí‚¹ì„ ê´€ë¦¬í•˜ëŠ” ì£¼ìš” ì»´í¬ë„ŒíŠ¸

- ê° K8s ë…¸ë“œì— ì„¤ì¹˜ë˜ë©°, í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ë„¤íŠ¸ì›Œí¬ í†µì‹  ë° ë¼ìš°íŒ… ê·œì¹™ì„ ì²˜ë¦¬
- Podê°„ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ê³ , ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ë¡œë¶€í„°ì˜ ì ‘ê·¼ì„ ê´€ë¦¬

#### Kube-Proxyì˜ ì£¼ìš”ê¸°ëŠ¥

1. ì„œë¹„ìŠ¤ ì¶”ìƒí™”
    1. K8sì˜ ì„œë¹„ìŠ¤ ì¶”ìƒí™”ë¥¼ êµ¬í˜„
    2. ì„œë¹„ìŠ¤ â‡’ Pod ê·¸ë£¹ì— ëŒ€í•œ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ì„ ì œê³µí•˜ëŠ” ì¶”ìƒì ì¸ ê°œë…
2. ë¡œë“œë°¸ëŸ°ì‹±
    1. í´ëŸ¬ì´ì–¸íŠ¸ ìš”ì²­ì„ ì„œë¹„ìŠ¤ì— ì—°ê²°ëœ ì—¬ëŸ¬ í¬ë“œ ì¤‘ í•˜ë‚˜ë¡œ ë¶„ì‚°ì‹œí‚¤ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤
3. ë„¤íŠ¸ì›Œí¬ ê·œì¹™ ê´€ë¦¬
    1. ê° ë…¸ë“œì˜ iptabels, ipvs ë˜ëŠ” ì‚¬ìš©ìž ê³µê°„ í”„ë¡ì‹œë¥¼ í†µí•´ ë„¤íŠ¸ì›Œí¬ ê·œì¹™ì„ ì„¤ì •í•˜ê³  ê´€ë¦¬í•¨
    â‡’ Pod, Service ë° Endpoint ê°„ì˜ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•´ì¤ë‹ˆë‹¤
4. ì™¸ë¶€ ì ‘ê·¼ ì²˜ë¦¬
    1. ì™¸ë¶€ì—ì„œ í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìžˆë„ë¡ NodePort LoadBalancer ë˜ëŠ” ClusterIP ì„œë¹„ìŠ¤ íƒ€ìž…ì„ í†µí•´ íŠ¸ëž˜í”½ì„ ì ì ˆí•œ Podë¡œ ë¼ìš°íŒ…í•©ë‹ˆë‹¤.

### Containerd

> ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ìž„ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì»´í¬ë„ŒíŠ¸

- K8s í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ê³  ì‹¤í–‰í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤

#### Containerdì˜ ì£¼ìš” ê¸°ëŠ¥ê³¼ íŠ¹ì§•

1. ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ë° ê´€ë¦¬
    1. ì»¨í…Œì´ë„ˆì˜ ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤
    â‡’ ì»¨í…Œì´ë„ˆì˜ ìƒì„±, ì‹¤í–‰, ì¼ì‹œ ì •ì§€, ìž¬ê°œ ë° ì¢…ë£Œ
2. ì´ë¯¸ì§€ ê´€ë¦¬
    1. ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œ, ì €ìž¥, ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤
    2. Dockerì´ë¯¸ì§€ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë˜ëŠ” OCI(Open Conatiner Initiative) í˜¸í™˜ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ í¬í•¨
3. ë„¤íŠ¸ì›Œí‚¹ ë° ìŠ¤í† ë¦¬ì§€
    1. ì»¨í…Œì´ë„ˆì— ëŒ€í•œ ë„¤íŠ¸ì›Œí‚¹ ë° ìŠ¤í† ë¦¬ì§€ ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ ì œê³µ
    2. CNI(Container Network Interface)ì™€ CSI(Container Storage Interface) í”ŒëŸ¬ê·¸ì¸ì„ í†µí•´ í™•ìž¥ ê°€ëŠ¥
4. ë³´ì•ˆ
    1. ì»¨í…Œì´ë„ˆì˜ ê²©ë¦¬ ë° ë³´ì•ˆì„ ìœ„í•´ Namespace, Cgroups, AppArmor, SELinux ë“±ì„ ì‚¬ìš©í•¨
5. ê°€ë²¼ì›€ ë° ì„±ëŠ¥
    1. Docker ë³´ë‹¤ ê°€ë²¼ìš´ ëŒ€ì•ˆìœ¼ë¡œ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ë¥¼ ì ê²Œ ì‚¬ìš©í•˜ë©°, ë” ë¹ ë¥¸ ì‹œìž‘ ì‹œê°„ê³¼ ì„±ëŠ¥ì„ ì œê³µ
6. í‘œì¤€í™” ë° í˜¸í™˜ì„±
    1. OCI í‘œì¤€ì„ ì¤€ìˆ˜ â‡’ ë‹¤ì–‘í•œ ì»¨í…Œì´ë„ˆ ë„êµ¬ ë° ì‹œìŠ¤í…œê³¼ì˜ í˜¸í™˜ì„± ë³´ìž¥

> **ê¶ê¸ˆí•˜ì‹ ì ì´ë‚˜ ì¶”ê°€í•´ì•¼í•  ë¶€ë¶„ì€ ëŒ“ê¸€ì´ë‚˜ ì•„ëž˜ì˜ ë§í¬ë¥¼ í†µí•´ ë¬¸ì˜í•´ì£¼ì„¸ìš”.**  
> **Written with [KKam.\_\.Ji](https://www.instagram.com/kkam._.ji/)**
{: .prompt-info}
